# 관문상가시장 지도 서비스 문서

## 프로젝트 개요
- **프로젝트명**: 관문상가시장 지도 서비스
- **주요 기능**: 
  - 이미지는 관문상가시장 안내도로, 실제 지도 API가 아닌 이미지 맵 기반으로 상점 위치를 표시하고 관리하는 시스템을 구축
  - 이미지 좌표 시스템: 상가 안내도 이미지((/assets/images/map.png) 위에 X, Y 좌표로 상점 위치 저장
  - 이미지 맵 핫스팟: HTML5 Canvas 또는 SVG 오버레이로 클릭 가능한 영역 구현
  - 좌표 매핑 도구: 관리자가 이미지(/assets/images/map.png) 위에서 마우스 클릭으로 상점 위치 지정
  - 반응형 지원

## 기술 스택
### Backend
- **언어**: Java 21
- **웹 프레임워크**: Spring Boot 3.5.4
- **서버**: Apache Tomcat (내장)
- **데이터베이스**: MySQL 8.0
- **빌드 도구**: Maven 3.6+

### Frontend
- **언어**: HTML5, CSS3, JavaScript
- **라이브러리**: Bootstrap 5, JSTL
- **템플릿 엔진**: JSP


## 프로젝트 구조
```
market-map/
├── src/
│   ├── main/
│   │   ├── java/com/example/Prime/
│   │   │   ├── config/              # 설정 클래스
│   │   │   │   └── SecurityConfig.java
│   │   │   ├── controller/          # 컨트롤러
│   │   │   │   ├── AdminController.java
│   │   │   │   └── TestController.java
│   │   │   ├── entity/              # JPA 엔티티
│   │   │   │   ├── Admin.java
│   │   │   │   ├── Contact.java
│   │   │   │   ├── FAQ.java
│   │   │   │   ├── Portfolio.java
│   │   │   │   ├── Qna.java
│   │   │   │   └── Register.java
│   │   │   ├── repository/          # 데이터 접근 계층
│   │   │   │   ├── AdminRepository.java
│   │   │   │   ├── ContactRepository.java
│   │   │   │   ├── FAQRepository.java
│   │   │   │   ├── PortfolioRepository.java
│   │   │   │   ├── QnaRepository.java
│   │   │   │   └── RegisterRepository.java
│   │   │   ├── service/             # 비즈니스 로직
│   │   │   │   ├── ApiService.java
│   │   │   │   ├── CustomUserDetailsService.java
│   │   │   │   └── KakaoService.java
│   │   │   ├── util/                # 유틸리티
│   │   │   │   └── PasswordGenerator.java
│   │   │   ├── HomeController.java  # 메인 컨트롤러
│   │   │   ├── PrimeApplication.java # 메인 애플리케이션 클래스
│   │   │   └── ServletInitializer.java
│   │   ├── resources/
│   │   │   ├── application.properties # 애플리케이션 설정
│   │   │   ├── db/init.sql          # 데이터베이스 초기화 스크립트
│   │   │   └── static/              # 정적 리소스
│   │   └── webapp/
│   │       ├── assets/              # CSS, JS, 이미지 파일
│   │       │   ├── css/
│   │       │   ├── fonts/
│   │       │   ├── images/
│   │       │   └── js/
│   │       ├── uploads/             # 업로드된 파일
│   │       └── WEB-INF/views/       # JSP 뷰 템플릿
│   │           ├── admin/           # 관리자 페이지
│   │           ├── *.jsp            # 사용자 페이지
│   │           ├── header.jsp       # 공통 헤더
│   │           └── footer.jsp       # 공통 푸터
│   └── test/
│       └── java/                    # 테스트 코드
├── pom.xml                          # Maven 설정
└── 프로젝트참고.md                        # 프로젝트 문서
```

## 주요 기능 및 페이지 구성

### 사용자 페이지(반응형 지원)
터치 제스처 지원(모바일 경우)
1. 드래그 이동
- 한 손가락으로 지도를 드래그하여 이동
- 부드러운 팬 제스처로 원하는 위치로 이동
2. 핀치 줌
- 두 손가락을 벌려서 확대
- 두 손가락을 모아서 축소
- 줌 레벨: 50% ~ 300%
3. 더블 탭
- 빠르게 두 번 탭하면 200% 확대
- 확대된 상태에서 더블 탭하면 100%로 복귀
4. 상점 탭
- 상점 마커를 탭하면 정보 팝업 표시
- 하단에서 슬라이드업 애니메이션으로 표시
5. UI 컨트롤
- 줌 버튼: +/- 버튼으로 단계별 확대/축소
- 현위치 버튼: 지도를 초기 위치로 리셋
- 구역 필터: 상단 탭으로 특정 구역만 표시


### 관리자 페이지 (`/admin`)
주요 기능
Step 1: 위치 선택
- 관리자가 지도 이미지(/assets/images/map.png)를 보면서 원하는 위치를 마우스로 클릭
- 클릭한 지점의 X, Y 좌표가 자동으로 캡처됨
- 임시 마커가 해당 위치에 표시됨
Step 2: 정보 입력
- 클릭하면 즉시 입력 폼이 팝업으로 나타남
- 상점 정보 입력:
- 상점명
- 구역 (좌표 기반으로 자동 추천)
- 전화번호
- 영업시간
- 설명
Step 3: 이미지 업로드
- 상점 대표 이미지 업로드
- 드래그 앤 드롭 또는 클릭으로 선택
- 다중 이미지 지원
Step 4: 저장
- 모든 정보가 데이터베이스에 저장
- 좌표 정보와 함께 저장되어 지도에 영구적으로 표시

- **로그인** : 관리자 인증
- **상점관리** : 전체 현황 통계
- **비밀번호 변경** : 관리자 계정 보안

## 데이터베이스
데이터베이스는 market-map 으로 생성해 두었음

-- 관리자 테이블
CREATE TABLE admin_users (
    admin_id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    name VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 상점 카테고리 테이블

-- 상가 지도 이미지 관리 테이블
CREATE TABLE market_maps (
    map_id INT PRIMARY KEY AUTO_INCREMENT,
    map_name VARCHAR(100) NOT NULL,
    map_image_url VARCHAR(500) NOT NULL,
    map_width INT NOT NULL,
    map_height INT NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 상점 정보 테이블 (이미지 좌표 기반)
CREATE TABLE stores (
    store_id INT PRIMARY KEY AUTO_INCREMENT,
    store_name VARCHAR(100) NOT NULL,
    store_code VARCHAR(50), -- 상점 코드 (예: 1지구-A01)
    zone_number INT, -- 지구 번호 (1지구, 2지구 등)
    phone_number VARCHAR(20),
    address VARCHAR(255),
    detail_address VARCHAR(100),
    map_id INT, -- 지도 이미지 참조
    x_coordinate INT, -- 이미지 상의 X 좌표
    y_coordinate INT, -- 이미지 상의 Y 좌표
    marker_radius INT DEFAULT 10, -- 마커 반경
    business_hours VARCHAR(200),
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES store_categories(category_id),
    FOREIGN KEY (created_by) REFERENCES admin_users(admin_id),
    FOREIGN KEY (map_id) REFERENCES market_maps(map_id),
    INDEX idx_coordinates (x_coordinate, y_coordinate),
    INDEX idx_store_name (store_name),
    INDEX idx_zone (zone_number),
    FULLTEXT KEY ft_store_name (store_name)
);

-- 상점 이미지 테이블
CREATE TABLE store_images (
    image_id INT PRIMARY KEY AUTO_INCREMENT,
    store_id INT NOT NULL,
    image_url VARCHAR(500) NOT NULL,
    image_type ENUM('main', 'sub') DEFAULT 'sub',
    display_order INT DEFAULT 0,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(store_id) ON DELETE CASCADE,
    INDEX idx_store_images (store_id)
);


-- 초기 관리자 계정 생성 (비밀번호: admin123을 해시화)
INSERT INTO admin_users (username, password, email, name) 
VALUES ('admin', 1234, 'admin@storeMap.com', '시스템관리자');


-- 샘플 상점 데이터
INSERT INTO stores (store_name, category_id, phone_number, address, latitude, longitude, business_hours, description, created_by) VALUES
('맛있는 김밥천국', 1, '031-123-4567', '경기도 구리시 인창동 123-45', 37.594747, 127.129512, '평일 07:00-22:00, 주말 08:00-21:00', '다양한 분식과 한식을 제공하는 음식점입니다.', 1),
('스타벅스 구리역점', 2, '031-234-5678', '경기도 구리시 수택동 234-56', 37.603123, 127.143621, '매일 07:00-23:00', '편안한 분위기의 커피 전문점입니다.', 1);

-- 뷰 생성: 상점 상세 정보
CREATE VIEW v_store_details AS
SELECT 
    s.store_id,
    s.store_name,
    s.phone_number,
    s.address,
    s.detail_address,
    s.latitude,
    s.longitude,
    s.business_hours,
    s.description,
    s.is_active,
    c.category_name,
    c.category_icon,
    GROUP_CONCAT(
        CASE WHEN si.image_type = 'main' 
        THEN si.image_url 
        ELSE NULL END
    ) AS main_image,
    COUNT(DISTINCT si.image_id) AS image_count
FROM stores s
LEFT JOIN store_categories c ON s.category_id = c.category_id
LEFT JOIN store_images si ON s.store_id = si.store_id
GROUP BY s.store_id;






### 2. 서버 설정
- **포트**: 8080 (기본값)
- **컨텍스트 경로**: `/`
- **로그 파일**: `market-map.log` 을 생성해줘
- **파일 업로드**: 최대 50MB

### 3. 접속 정보
- **사용자 페이지**: http://localhost:8080
- **관리자 페이지**: http://localhost:8080/admin/login
- **기본 관리자 계정**: admin / admin123

### 자주 발생하는 문제들
1. **데이터베이스 연결 오류**: MySQL 서버 상태 및 연결 정보 확인
2. **JSP 페이지 로딩 오류**: Tomcat Embed Jasper 의존성 확인
3. **파일 업로드 오류**: 업로드 디렉토리 권한 및 파일 크기 제한 확인
4. **카카오톡 알림 오류**: API 키 및 설정 정보 확인


